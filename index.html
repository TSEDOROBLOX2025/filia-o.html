<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brookasil RP ‚Äì Sistema Governamental</title>
    <style>
        :root {
            --primary: #0a7cff;
            --primary-dark: #0056b3;
            --secondary: #0bb37b;
            --danger: #ff4747;
            --bg: #f4f7f9;
            --text: #2d3436;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            margin: 0;
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary), #00c6ff);
            color: #fff;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        header h1 { margin: 0; font-size: 2rem; letter-spacing: 1px; }

        main { max-width: 1100px; margin: -30px auto 50px; padding: 0 20px; }

        .tab-buttons {
            display: flex;
            gap: 5px;
            background: #fff;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .tab-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .tab-buttons button.active { background: var(--primary); color: white; }

        .box {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 25px;
        }

        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        label { font-weight: 600; font-size: 0.9rem; color: #555; margin-bottom: 5px; display: block; }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #fafafa;
            transition: border 0.3s;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input:focus, select:focus { border-color: var(--primary); outline: none; background: #fff; }

        .btn-submit {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s, background 0.3s;
        }

        .btn-submit:hover { background: #098a5e; transform: translateY(-2px); }

        .table-container { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f8f9fa; color: #666; font-weight: 600; text-align: left; padding: 15px; border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        tr:hover { background: #fcfcfc; }

        .badge-total { background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; }
        .hidden { display: none !important; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .delete-btn { background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1>üó≥Ô∏è Brookasil RP</h1>
    <p>Tribunal Superior Eleitoral - Sistema de Gest√£o</p>
</header>

<main>
    <div class="tab-buttons">
        <button class="active" onclick="abrirAba('filiacoesTab', this)">üìÑ Filia√ß√µes</button>
        <button onclick="abrirAba('obrasTab', this)">üèóÔ∏è Mural de Obras</button>
        <button onclick="abrirAba('admTab', this)">üîê Painel ADM</button>
    </div>

    <div id="filiacoesTab" class="tab-content active box">
        <h2>üìÑ Ficha de Filia√ß√£o</h2>
        <form id="formFiliacao">
            <div class="form-grid">
                <div>
                    <label>Nome completo</label>
                    <input id="nome" required placeholder="Nome do Cidad√£o">
                </div>
                <div>
                    <label>Data de nascimento</label>
                    <input type="date" id="nascimento" required>
                </div>
                <div>
                    <label>CPF (Passaporte)</label>
                    <input id="cpf" type="number" required placeholder="Ex: 1234">
                </div>
                <div>
                    <label>TikTok</label>
                    <input id="tiktok" required placeholder="@usuario">
                </div>
                <div>
                    <label>Zona Eleitoral</label>
                    <select id="zona" required>
                        <option value="">Selecione</option>
                        <optgroup label="BH (Belo Horizonte)">
                            <option>BH-01</option><option>BH-02</option><option>BH-03</option><option>BH-04</option>
                        </optgroup>
                        <optgroup label="NC (Nova Capital)">
                            <option>NC-01</option><option>NC-02</option><option>NC-03</option>
                        </optgroup>
                        <optgroup label="FX (Favelas)">
                            <option>FX-01</option><option>FX-02</option><option>FX-03</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label>Lado Pol√≠tico</label>
                    <select id="lado" required>
                        <option value="">Selecione</option>
                        <option value="Direita">Direita</option>
                        <option value="Centro">Centro</option>
                        <option value="Esquerda">Esquerda</option>
                    </select>
                </div>
                <div>
                    <label>Partido</label>
                    <select id="partido" required><option value="">Selecione o Lado</option></select>
                </div>
                <div>
                    <label>Cargo Pretendido</label>
                    <select id="cargoPretendido" required>
                        <option value="">Selecione</option>
                        <option>Eleitor/Apoiador</option>
                        <option>Vereador</option>
                        <option>Prefeito</option>
                        <option>Governador</option>
                        <option>Presidente</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-submit">Confirmar Filia√ß√£o / Atualizar</button>
        </form>

        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px; margin-top:30px;">
            <div class="table-container">
                <h3>üìä Ranking de Partidos</h3>
                <table><thead><tr><th>Partido</th><th>Total</th></tr></thead><tbody id="contadorPartidos"></tbody></table>
            </div>
            <div class="table-container">
                <h3>üìç Densidade por Zona</h3>
                <table><thead><tr><th>Zona</th><th>Total</th></tr></thead><tbody id="contadorZonas"></tbody></table>
            </div>
        </div>
    </div>

    <div id="obrasTab" class="tab-content box">
        <h2>üèóÔ∏è Mural de Obras P√∫blicas</h2>
        <div class="form-grid">
            <select id="cargoObra">
                <option value="">Seu Cargo</option>
                <option>Prefeito</option>
                <option>Governador</option>
                <option>Presidente</option>
            </select>
            <input type="password" id="senhaObra" placeholder="Senha Governamental">
            <input id="tituloObra" placeholder="T√≠tulo da Obra">
            <input id="localObra" placeholder="Local">
        </div>
        <textarea id="descricaoObra" placeholder="Descri√ß√£o completa..." style="margin-top:10px; height:80px"></textarea>
        <button onclick="registrarObra()" class="btn-submit" style="background:var(--primary)">Publicar Obra</button>

        <div class="table-container">
            <table>
                <thead><tr><th>Obra</th><th>Autoridade</th><th>Local</th><th>Data</th><th id="colAcaoObra" class="hidden">A√ß√£o</th></tr></thead>
                <tbody id="listaObras"></tbody>
            </table>
        </div>
    </div>

    <div id="admTab" class="tab-content box">
        <h2>üîê Painel Administrativo</h2>
        <div id="loginAdm" style="display: flex; gap:10px">
            <input type="password" id="senhaAdm" placeholder="Senha Master">
            <button onclick="entrarAdm()" class="btn-submit" style="margin:0; width:150px">Entrar</button>
        </div>
        <div id="areaAdm" class="hidden">
            <p>Total de Filiados: <span class="badge-total" id="total">0</span></p>
            <div class="table-container">
                <table>
                    <thead><tr><th>Nome</th><th>Passaporte</th><th>Zona</th><th>Partido</th><th>TikTok</th><th>A√ß√£o</th></tr></thead>
                    <tbody id="listaFiliados"></tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
// Config Firebase
firebase.initializeApp({databaseURL: "https://filiacao-rp-default-rtdb.firebaseio.com"});
const db = firebase.database();

const partidosMap = {
  Direita: ["PL (22)", "PP (11)", "Republicanos (10)", "NOVO (30)", "UDB (38)"],
  Centro: ["MDB (15)", "UNI√ÉO (44)", "PSD (55)", "PSDB (45)", "Cidadania"],
  Esquerda: ["PT (13)", "PSOL (50)", "PCdoB (65)", "PDT (12)", "UP (80)"]
};

document.getElementById("lado").onchange = function() {
    const pSel = document.getElementById("partido");
    pSel.innerHTML = "<option value=''>Selecione</option>";
    (partidosMap[this.value] || []).forEach(p => pSel.innerHTML += `<option>${p}</option>`);
};

// FILIA√á√ÉO COM L√ìGICA DE SUBSTITUI√á√ÉO (Nome + TikTok)
document.getElementById("formFiliacao").onsubmit = e => {
    e.preventDefault();
    
    const nomeNovo = document.getElementById("nome").value;
    const tiktokNovo = document.getElementById("tiktok").value;

    const novosDados = {
        nome: nomeNovo,
        nascimento: document.getElementById("nascimento").value,
        cpf: document.getElementById("cpf").value,
        tiktok: tiktokNovo,
        zona: document.getElementById("zona").value,
        partido: document.getElementById("partido").value,
        cargoPretendido: document.getElementById("cargoPretendido").value,
        timestamp: new Date().getTime()
    };

    // Verifica duplicidade antes de salvar
    db.ref("filiacoes").once("value", snapshot => {
        const data = snapshot.val();
        if (data) {
            Object.entries(data).forEach(([id, registro]) => {
                // Se nome e tiktok forem iguais, remove o antigo
                if (registro.nome === nomeNovo && registro.tiktok === tiktokNovo) {
                    db.ref(`filiacoes/${id}`).remove();
                }
            });
        }

        // Salva o novo registro
        db.ref("filiacoes").push(novosDados).then(() => {
            alert("Sucesso! Filia√ß√£o registrada/atualizada.");
            document.getElementById("formFiliacao").reset();
        });
    });
};

// Listeners e Renderiza√ß√£o
db.ref("filiacoes").on("value", s => {
    const data = s.val() || {};
    const lista = document.getElementById("listaFiliados");
    const contPartidos = document.getElementById("contadorPartidos");
    const contZonas = document.getElementById("contadorZonas");
    
    let pCount = {}, zCount = {}, total = 0;
    lista.innerHTML = "";

    Object.entries(data).forEach(([id, f]) => {
        total++;
        pCount[f.partido] = (pCount[f.partido] || 0) + 1;
        zCount[f.zona] = (zCount[f.zona] || 0) + 1;

        lista.innerHTML += `<tr><td>${f.nome}</td><td>${f.cpf}</td><td>${f.zona}</td><td>${f.partido}</td><td>${f.tiktok}</td>
        <td><button class="delete-btn" onclick="removerFiliado('${id}')">X</button></td></tr>`;
    });

    document.getElementById("total").textContent = total;
    contPartidos.innerHTML = Object.entries(pCount).map(([k,v]) => `<tr><td>${k}</td><td><b>${v}</b></td></tr>`).join("");
    contZonas.innerHTML = Object.entries(zCount).map(([k,v]) => `<tr><td>${k}</td><td><b>${v}</b></td></tr>`).join("");
});

// Obras
const SENHAS = {Prefeito:"popo30", Governador:"caiado44", Presidente:"henrique44"};
function registrarObra() {
    const cargo = document.getElementById("cargoObra").value;
    if(SENHAS[cargo] !== document.getElementById("senhaObra").value) return alert("Senha incorreta");

    db.ref("obras").push({
        cargo, titulo: document.getElementById("tituloObra").value,
        local: document.getElementById("localObra").value,
        descricao: document.getElementById("descricaoObra").value,
        data: new Date().toLocaleDateString("pt-BR")
    }).then(() => alert("Publicado!"));
}

function renderObras() {
    db.ref("obras").on("value", s => {
        const list = document.getElementById("listaObras");
        list.innerHTML = "";
        Object.entries(s.val() || {}).forEach(([id, o]) => {
            list.innerHTML += `<tr><td><b>${o.titulo}</b><br><small>${o.descricao}</small></td><td>${o.cargo}</td><td>${o.local}</td><td>${o.data}</td>
            ${admLogado ? `<td><button class="delete-btn" onclick="removerObra('${id}')">X</button></td>` : ""}</tr>`;
        });
    });
}
renderObras();

let admLogado = false;
function entrarAdm() {
    if(document.getElementById("senhaAdm").value === "Brookasil1234") {
        admLogado = true;
        document.getElementById("loginAdm").classList.add("hidden");
        document.getElementById("areaAdm").classList.remove("hidden");
        document.getElementById("colAcaoObra").classList.remove("hidden");
        renderObras();
    }
}

function removerFiliado(id) { if(confirm("Deletar filiado?")) db.ref("filiacoes/"+id).remove(); }
function removerObra(id) { if(confirm("Deletar obra?")) db.ref("obras/"+id).remove(); }

function abrirAba(id, btn) {
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    btn.classList.add("active");
}
</script>
</body>
</html>
