<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brookasil RP | Sistema Governamental</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.95);
            --primary: #0046ad;
            --accent: #00d4ff;
            --gold: #d4af37;
            --dark: #1a1c20;
            --success: #00b894;
            --danger: #ff7675;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d7e1ec 100%);
            background-attachment: fixed;
            margin: 0;
            color: var(--dark);
        }

        /* Fundo Animado Sutil */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/cubes.png');
            opacity: 0.05;
            z-index: -1;
        }

        header {
            background: var(--dark);
            color: white;
            padding: 60px 20px;
            text-align: center;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0% 100%);
            border-bottom: 4px solid var(--gold);
        }

        header h1 {
            margin: 0;
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(to right, #fff, var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p { opacity: 0.8; font-weight: 300; margin-top: 10px; font-size: 1.1rem; }

        main { max-width: 1200px; margin: -40px auto 100px; padding: 0 20px; }

        /* Menu de Abas Estilizado */
        .tab-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .tab-buttons button {
            padding: 15px 30px;
            border: none;
            background: var(--glass);
            color: var(--dark);
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-buttons button.active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 70, 173, 0.3);
        }

        .tab-buttons button:hover:not(.active) {
            transform: translateY(-3px);
            background: #fff;
        }

        /* Boxes e Efeitos */
        .box {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.5);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { font-weight: 800; color: var(--primary); margin-bottom: 30px; font-size: 1.8rem; display: flex; align-items: center; gap: 15px; }
        h2::after { content: ""; flex: 1; height: 2px; background: linear-gradient(to right, #eee, transparent); }

        /* Formul√°rios Elegantes */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }

        label { font-weight: 600; font-size: 0.85rem; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e6ed;
            background: #f8fafc;
            transition: all 0.3s;
            font-size: 1rem;
            box-sizing: border-box;
            color: var(--dark);
        }

        input:focus, select:focus {
            border-color: var(--accent);
            background: #fff;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
            transition: all 0.3s;
            box-shadow: 0 10px 20px rgba(0, 70, 173, 0.2);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0, 70, 173, 0.3);
            filter: brightness(1.1);
        }

        /* Tabelas Modernas */
        .table-container { overflow-x: auto; margin-top: 30px; border-radius: 15px; background: white; }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { background: #f1f4f9; padding: 20px; text-align: left; font-size: 0.8rem; text-transform: uppercase; color: #64748b; }
        td { padding: 20px; border-bottom: 1px solid #f1f4f9; }
        tr:last-child td { border: none; }
        tr:hover td { background: #f8fbff; }

        .badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            background: var(--primary);
            color: white;
        }

        .delete-btn {
            background: #fff0f0;
            color: var(--danger);
            border: 1px solid #ffebeb;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .delete-btn:hover { background: var(--danger); color: white; }

        .hidden { display: none !important; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Responsividade */
        @media (max-width: 768px) {
            header h1 { font-size: 2rem; }
            .tab-buttons { flex-direction: column; }
            .box { padding: 20px; }
        }
    </style>
</head>
<body>

<header>
    <h1>BROOKASIL RP</h1>
    <p>SISTEMA INTEGRADO DO TRIBUNAL SUPERIOR ELEITORAL</p>
</header>

<main>
    <div class="tab-buttons">
        <button class="active" onclick="abrirAba('filiacoesTab', this)"><span>üìÑ</span> Filia√ß√µes</button>
        <button onclick="abrirAba('obrasTab', this)"><span>üèóÔ∏è</span> Mural de Obras</button>
        <button onclick="abrirAba('admTab', this)"><span>üîê</span> Painel ADM</button>
    </div>

    <div id="filiacoesTab" class="tab-content active box">
        <h2>Ficha de Registro Oficial</h2>
        <form id="formFiliacao">
            <div class="form-grid">
                <div>
                    <label>Nome Completo do Cidad√£o</label>
                    <input id="nome" required placeholder="Ex: Gabriel Henrique">
                </div>
                <div>
                    <label>Data de Nascimento</label>
                    <input type="date" id="nascimento" required>
                </div>
                <div>
                    <label>N¬∫ Passaporte (CPF)</label>
                    <input id="cpf" type="number" required placeholder="Identidade √∫nica">
                </div>
                <div>
                    <label>TikTok / Redes Sociais</label>
                    <input id="tiktok" required placeholder="@seu_perfil">
                </div>
                <div>
                    <label>Distrito Eleitoral (Zona)</label>
                    <select id="zona" required>
                        <option value="">Selecione a regi√£o</option>
                        <optgroup label="Belo Horizonte">
                            <option>BH-01</option><option>BH-02</option><option>BH-03</option>
                        </optgroup>
                        <optgroup label="Nova Capital">
                            <option>NC-01</option><option>NC-02</option>
                        </optgroup>
                        <optgroup label="Periferias/Complexos">
                            <option>FX-01</option><option>FX-02</option>
                        </optgroup>
                    </select>
                </div>
                <div>
                    <label>Espectro Pol√≠tico</label>
                    <select id="lado" required>
                        <option value="">Selecione o lado</option>
                        <option value="Direita">Direita</option>
                        <option value="Centro">Centro</option>
                        <option value="Esquerda">Esquerda</option>
                    </select>
                </div>
                <div>
                    <label>Partido Pol√≠tico</label>
                    <select id="partido" required><option value="">Aguardando lado...</option></select>
                </div>
                <div>
                    <label>Cargo de Pretens√£o</label>
                    <select id="cargoPretendido" required>
                        <option value="">Selecione o cargo</option>
                        <option>Apenas Eleitor</option>
                        <option>Vereador</option>
                        <option>Prefeito</option>
                        <option>Governador</option>
                        <option>Presidente</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-submit">FINALIZAR REGISTRO GOVERNAMENTAL</button>
        </form>

        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap:30px; margin-top:50px;">
            <div class="table-container">
                <h3 style="padding:20px 20px 0;">üìä Estat√≠sticas de Partidos</h3>
                <table><thead><tr><th>Sigla</th><th>Filiados</th></tr></thead><tbody id="contadorPartidos"></tbody></table>
            </div>
            <div class="table-container">
                <h3 style="padding:20px 20px 0;">üìç Densidade Populacional</h3>
                <table><thead><tr><th>Zona</th><th>Total</th></tr></thead><tbody id="contadorZonas"></tbody></table>
            </div>
        </div>
    </div>

    <div id="obrasTab" class="tab-content box">
        <h2>Mural de Investimentos P√∫blicos</h2>
        <div class="form-grid">
            <select id="cargoObra">
                <option value="">Seu Cargo</option>
                <option>Prefeito</option>
                <option>Governador</option>
                <option>Presidente</option>
            </select>
            <input type="password" id="senhaObra" placeholder="C√≥digo de Seguran√ßa">
            <input id="tituloObra" placeholder="T√≠tulo do Projeto">
            <input id="localObra" placeholder="Localidade">
        </div>
        <textarea id="descricaoObra" placeholder="Detalhamento t√©cnico da obra..." style="margin-top:20px; height:100px"></textarea>
        <button onclick="registrarObra()" class="btn-submit" style="background:var(--dark)">PUBLICAR PROJETO</button>

        <div class="table-container">
            <table>
                <thead><tr><th>Projeto</th><th>Respons√°vel</th><th>Local</th><th>Data</th><th id="colAcaoObra" class="hidden">Gest√£o</th></tr></thead>
                <tbody id="listaObras"></tbody>
            </table>
        </div>
    </div>

    <div id="admTab" class="tab-content box">
        <h2>Painel de Controle Nacional</h2>
        <div id="loginAdm" style="display: flex; gap:15px; align-items: center; max-width: 500px;">
            <input type="password" id="senhaAdm" placeholder="Chave Mestra Administrativa">
            <button onclick="entrarAdm()" class="btn-submit" style="margin:0; width:180px">ACESSAR</button>
        </div>
        <div id="areaAdm" class="hidden">
            <div style="margin: 30px 0; font-size: 1.2rem;">
                Cidad√£os Cadastrados: <span class="badge" id="total" style="font-size: 1.2rem; padding: 10px 20px;">0</span>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>Cidad√£o</th><th>Passaporte</th><th>Distrito</th><th>Partido</th><th>TikTok</th><th>Gerenciar</th></tr></thead>
                    <tbody id="listaFiliados"></tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
firebase.initializeApp({databaseURL: "https://filiacao-rp-default-rtdb.firebaseio.com"});
const db = firebase.database();

const partidosMap = {
  Direita: ["PL (22)", "PP (11)", "Republicanos (10)", "NOVO (30)", "UDB (38)"],
  Centro: ["MDB (15)", "UNI√ÉO (44)", "PSD (55)", "PSDB (45)", "Cidadania"],
  Esquerda: ["PT (13)", "PSOL (50)", "PCdoB (65)", "PDT (12)", "UP (80)"]
};

document.getElementById("lado").onchange = function() {
    const pSel = document.getElementById("partido");
    pSel.innerHTML = "<option value=''>Selecione</option>";
    (partidosMap[this.value] || []).forEach(p => pSel.innerHTML += `<option>${p}</option>`);
};

// L√≥gica de Substitui√ß√£o (A sua mudan√ßa pedida)
document.getElementById("formFiliacao").onsubmit = e => {
    e.preventDefault();
    const nome = document.getElementById("nome").value;
    const tiktok = document.getElementById("tiktok").value;

    const dados = {
        nome,
        nascimento: document.getElementById("nascimento").value,
        cpf: document.getElementById("cpf").value,
        tiktok,
        zona: document.getElementById("zona").value,
        partido: document.getElementById("partido").value,
        cargoPretendido: document.getElementById("cargoPretendido").value,
        data: new Date().getTime()
    };

    db.ref("filiacoes").once("value", snap => {
        const registros = snap.val();
        if(registros) {
            Object.entries(registros).forEach(([id, reg]) => {
                // Remove registro antigo se Nome e TikTok forem iguais
                if(reg.nome === nome && reg.tiktok === tiktok) {
                    db.ref(`filiacoes/${id}`).remove();
                }
            });
        }
        db.ref("filiacoes").push(dados).then(() => {
            alert("‚úÖ Registro processado com sucesso!");
            document.getElementById("formFiliacao").reset();
        });
    });
};

// Sincroniza√ß√£o em Tempo Real
db.ref("filiacoes").on("value", s => {
    const data = s.val() || {};
    const lista = document.getElementById("listaFiliados");
    let pCount = {}, zCount = {}, total = 0;
    lista.innerHTML = "";

    Object.entries(data).forEach(([id, f]) => {
        total++;
        pCount[f.partido] = (pCount[f.partido] || 0) + 1;
        zCount[f.zona] = (zCount[f.zona] || 0) + 1;
        lista.innerHTML += `<tr><td><b>${f.nome}</b></td><td>${f.cpf}</td><td>${f.zona}</td><td><span class="badge">${f.partido}</span></td><td>${f.tiktok}</td>
        <td><button class="delete-btn" onclick="removerFiliado('${id}')">Deletar</button></td></tr>`;
    });

    document.getElementById("total").textContent = total;
    document.getElementById("contadorPartidos").innerHTML = Object.entries(pCount).map(([k,v]) => `<tr><td>${k}</td><td><b>${v}</b></td></tr>`).join("");
    document.getElementById("contadorZonas").innerHTML = Object.entries(zCount).map(([k,v]) => `<tr><td>${k}</td><td><b>${v}</b></td></tr>`).join("");
});

// Mural de Obras
const SENHAS = {Prefeito:"popo30", Governador:"caiado44", Presidente:"henrique44"};
function registrarObra() {
    const cargo = document.getElementById("cargoObra").value;
    if(SENHAS[cargo] !== document.getElementById("senhaObra").value) return alert("‚ùå Senha Governamental Inv√°lida!");

    db.ref("obras").push({
        cargo, titulo: document.getElementById("tituloObra").value,
        local: document.getElementById("localObra").value,
        descricao: document.getElementById("descricaoObra").value,
        data: new Date().toLocaleDateString("pt-BR")
    }).then(() => alert("üöÄ Obra publicada no mural nacional!"));
}

function renderObras() {
    db.ref("obras").on("value", s => {
        const list = document.getElementById("listaObras");
        list.innerHTML = "";
        Object.entries(s.val() || {}).forEach(([id, o]) => {
            list.innerHTML += `<tr><td><b>${o.titulo}</b><br><small style="color:#666">${o.descricao}</small></td><td>${o.cargo}</td><td>${o.local}</td><td>${o.data}</td>
            ${admLogado ? `<td><button class="delete-btn" onclick="removerObra('${id}')">Apagar</button></td>` : ""}</tr>`;
        });
    });
}
renderObras();

let admLogado = false;
function entrarAdm() {
    if(document.getElementById("senhaAdm").value === "Brookasil1234") {
        admLogado = true;
        document.getElementById("loginAdm").classList.add("hidden");
        document.getElementById("areaAdm").classList.remove("hidden");
        document.getElementById("colAcaoObra").classList.remove("hidden");
        renderObras();
    } else { alert("Acesso Negado!"); }
}

function removerFiliado(id) { if(confirm("Confirmar exclus√£o?")) db.ref("filiacoes/"+id).remove(); }
function removerObra(id) { if(confirm("Confirmar exclus√£o da obra?")) db.ref("obras/"+id).remove(); }

function abrirAba(id, btn) {
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    btn.classList.add("active");
}
</script>
</body>
</html>
